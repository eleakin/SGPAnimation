---
title: "SGPanimation "
output: github_document
---

```{r setup, include=FALSE}

#The following chunk is taken and modified from dgrtwo's github page. It makes is possible for GIFs to render on a github page
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "SGPAnimationFiles/fig-",
  cache.path = "SGPAnimationFiles/cache-"
)
library(knitr)
library(animation)
knitr::opts_chunk$set(echo = TRUE)
opts_knit$set(animation.fun = function(x, options, format = "gif") {
  x = c(knitr:::sans_ext(x), knitr:::file_ext(x))
  fig.num = options$fig.num
  format = sub("^[.]", "", format)
  fig.fname = paste0(sub(paste0(fig.num, "$"), "*", x[1]), 
                     ".", x[2])
  mov.fname = paste0(sub(paste0(fig.num, "$"), "", x[1]), ".", 
                     format)

  # order correctly
  figs <- Sys.glob(fig.fname)
  figs <- figs[order(as.numeric(stringr::str_match(figs, paste0("(\\d+)\\.", x[2]))[, 2]))]

  animation::im.convert(figs, output = mov.fname)

  sprintf("![%s](%s)", options$label, paste0(opts_knit$get("base.url"), mov.fname))
})

opts_chunk$set(cache = TRUE, message = FALSE, warning = FALSE, fig.show = "animate")
```

## Purpose
Purpose of this book is to develop an animation that takes advantage of **gganimate**, **tweenr**, and other R packages. The animation will hopefully provide an intuitive animation for how student growth percentiles are created in the NYC Department of Education.

## Load Packages

```{r packages}
library(ggplot2)
library(gganimate)
library(ggforce)
library(tweenr)
```

## Create Data

The data created below is based on the **tweenr** Github example

```{r loadData, echo=TRUE}
# Making up data
t <- data.frame(x=seq(0:11), y=rep(0,12), colour = 'forestgreen', size=0.5, alpha = 1, 
                stringsAsFactors = FALSE)
t$colour<-ifelse(t$x==5, 'steelblue',t$colour)
#t <- t[rep(1, 12),]
#t$alpha[2:12] <- 0
t2 <- t
t2$y <- 1
t2$x<-0
t2$colour <- 'firebrick'
t2$size<-10
t3 <- t2
t3$x <- 1
t3$colour <- 'steelblue'
t4 <- t3
t4$y <- 0
t4$colour <- 'goldenrod'
t9 <- t
ts <- list(t, t2)
```

## Apply **tweenr** Function and Plot
For the time being, I am just trying to wrap my head around using **tweenr** package. The goal is to plot 10 distinct points that lie on the x-axis and then converge into a larger point on the y-axis.

Still having trouble plotting the animation file in markdown and getting the plot to loop/run quickly.
```{r tweenr, echo=TRUE, fig.show='animate', interval=1/15}
# Using tweenr
tf <- tween_states(ts, tweenlength = 2, statelength = 1, 
                   ease = c('cubic-in-out', 'elastic-out'), 
                   nframes = 175)

# Animate with gganimate
p <- ggplot(data=tf, aes(x=x, y=y)) + 
  #geom_text(aes(label = label, frame = .frame), data=tweenlogo, size = 13) + 
  geom_point(aes(frame=.frame, size=size, alpha =alpha, colour = colour)) + 
  scale_colour_identity() + 
  scale_alpha(range = c(1, 1), guide = 'none') +
  scale_size(range = c(2, 15), guide = 'none') + 
  theme_bw()
animation::ani.options(interval = 1/15)
gganimate(p)
```
The plot above should be animated.
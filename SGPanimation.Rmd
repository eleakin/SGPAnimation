---
title: "SGPanimation "
output: github_document
---

```{r setup, include=FALSE}

#The following chunk is taken and modified from dgrtwo's github page. It makes is possible for GIFs to render on a github page
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "SGPAnimationFiles/fig-",
  cache.path = "SGPAnimationFiles/cache-"
)
library(knitr)
library(animation)
knitr::opts_chunk$set(echo = TRUE)
opts_knit$set(animation.fun = function(x, options, format = "gif") {
  x = c(knitr:::sans_ext(x), knitr:::file_ext(x))
  fig.num = options$fig.num
  format = sub("^[.]", "", format)
  fig.fname = paste0(sub(paste0(fig.num, "$"), "*", x[1]), 
                     ".", x[2])
  mov.fname = paste0(sub(paste0(fig.num, "$"), "", x[1]), ".", 
                     format)

  # order correctly
  figs <- Sys.glob(fig.fname)
  figs <- figs[order(as.numeric(stringr::str_match(figs, paste0("(\\d+)\\.", x[2]))[, 2]))]

  animation::im.convert(figs, output = mov.fname)

  sprintf("![%s](%s)", options$label, paste0(opts_knit$get("base.url"), mov.fname))
})

opts_chunk$set(cache = TRUE, message = FALSE, warning = FALSE, fig.show = "animate")
```

## Purpose
Purpose of this book is to develop an animation that takes advantage of **gganimate**, **tweenr**, and other R packages. The animation will hopefully provide an intuitive animation for how student growth percentiles are calculated using an approach *similar* to the NYC Department of Education.

**Disclaimer**: I contributed to this book in my own personal capacity. The views and content expressed here are my own and do not necessarily represent the views of the NYC Department of Education. 

```{r packages, include=FALSE}
library(ggplot2)
library(gganimate)
library(ggforce)
library(tweenr)
source('studentAppear.R')
source('plotStudents.R')
source('lmStudents.R')
source('predictStudents.R')
source('findPeers.R')
source('assignSGP.R')
```

## Student Growth

The NYC Department of Education (NYCDOE) calculates a student's growth over the course of an academic year by calculating a student growth percentile -- or an SGP. An SGP is a simple calculation where a student's achievement at the end of a year is compared to the achievement of other 'similar' students. Typically, similar students -- commonly refered to as *peer* students -- are defined as students that start the school year with similar prior achievement scores. The NYCDOE defines peer students differently. Instead of defining peer students based only on their prior achievement scores at the start of the school year, the NYCDOE also takes demographic characteristics into consideration (e.g. English language learner status, economic disadvantage).

To identify groups of similar students based on all these characteristics, the NYCDOE runs a **regression**. That's just a fancy of saying that they use all the prior achievement scores and demographic data they have to estimate what they think a student should score at the end of the year. 

Let's walkthrough a series of animations to get a better picture of what that looks like.

## Students of All Backgrounds

*Under Construction - Explanation pending*


```{r appear, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p1, title_frame = FALSE)

```

## Plot Students by Prior Achievement

*Under Construction - Explanation pending*

```{r plot, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p2, title_frame = FALSE)

```

## Fit a Regression Line

*Under Construction - Explanation pending*

```{r lm, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p3, title_frame = FALSE)

```

##Estimate Fitted EOY Achievement

*Under Construction - Explanation pending*

```{r predict, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p4, title_frame = FALSE)

```

##Assign peer groups for each student

*Under Construction - Explanation pending*


```{r findPeers, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p5, title_frame = FALSE)

```

##Assign Student Growth Percentile

*Under Construction - Explanation pending*



```{r assign, echo=FALSE, fig.show='animate', interval=1/15}

gganimate(p6, title_frame = FALSE)

```

